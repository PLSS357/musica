/* ===== Reset básico ===== */
*, *::before, *::after { box-sizing: border-box; }
html, body { height: 100%; }
body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

/* ===== Variáveis responsivas ===== */
:root{
  /* largura base da caixa: se adapta ao viewport */
  --box-w: min(88vw, 420px);
  /* proporção da caixa (320x220 ≈ 0.6875 de altura em relação à largura) */
  --box-h: calc(var(--box-w) * 0.6875);
  /* altura da tampa relativa ao tamanho da caixa */
  --lid-h: clamp(22px, 9vw, 38px);
  /* tamanho do “vinil” (foto redonda) */
  --vinyl: clamp(120px, 36vw, 180px);
  /* tipografia */
  --status-size: clamp(14px, 2.3vw, 18px);
  --instruction-size: clamp(12px, 1.8vw, 14px);
  --radius: 16px;
}

/* ===== Layout de fundo ===== */
body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: grid; place-items: center;
  overflow: auto; /* permite rolar em telas pequenas */
  padding: 6vh 4vw calc(8vh + env(safe-area-inset-bottom));
}

/* ===== Container com perspectiva ===== */
.music-box-container {
  position: relative;
  perspective: 1000px;
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  animation: fadeInUp 0.9s ease-out;
  width: var(--box-w);
  /* espaço para controles abaixo em telas pequenas */
  margin-bottom: 96px;
}

.music-box {
  width: var(--box-w);
  height: var(--box-h);
  position: relative;
  transform-style: preserve-3d;
  transition: filter 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.music-box.open { filter: drop-shadow(0 0 20px rgba(255,255,255,0.3)); }

.box-base {
  width: 100%; height: 100%; position: relative; overflow: hidden;
  border-radius: var(--radius);
  background: linear-gradient(145deg, #8b5a2b, #a05f2b);
  box-shadow:
    0 20px 40px rgba(0,0,0,0.3),
    inset 0 2px 0 rgba(255,255,255,0.12),
    inset 0 -2px 0 rgba(0,0,0,0.25);
}

.box-base::before {
  content: ""; position: absolute; inset: 0; border-radius: var(--radius);
  background:
    linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.08) 50%, transparent 100%),
    repeating-linear-gradient(45deg, rgba(139,69,19,0.06) 0 3px, rgba(0,0,0,0.06) 3px 6px);
  pointer-events: none;
}

.box-lid {
  width: 100%; height: var(--lid-h);
  background: linear-gradient(145deg, #cd8a47, #d2691e);
  position: absolute; top: calc(-1 * var(--lid-h)); left: 0;
  border-radius: var(--radius) var(--radius) 6px 6px;
  transform-origin: bottom center;
  transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 -10px 20px rgba(0,0,0,0.22), inset 0 2px 0 rgba(255,255,255,0.22);
  z-index: 10; transform: rotateX(0deg);
}
.box-lid.open { transform: rotateX(-120deg); }

.lid-hinge {
  position: absolute; bottom: -2px; left: 50%; transform: translateX(-50%);
  width: clamp(64px, 24vw, 100px); height: 4px; border-radius: 2px;
  background: #6f3d17; box-shadow: inset 0 1px 0 rgba(0,0,0,0.35);
}

.music-box-interior {
  position: absolute; inset: 0; padding: clamp(14px, 4vw, 22px);
  border-radius: var(--radius);
  background:
    linear-gradient(145deg, #8b5a2b, #a05f2b),
    repeating-linear-gradient(45deg, rgba(139,69,19,0.85) 0 3px, rgba(160,82,45,0.55) 3px 6px);
  box-shadow: inset 0 0 22px rgba(0,0,0,0.35);
  display: grid; place-items: center;
  opacity: 0; transition: opacity 0.5s ease-in-out 0.3s;
}
.music-box-interior.visible { opacity: 1; }

/* ===== Disco (foto circular girando) ===== */
.vinyl-record {
  width: var(--vinyl); height: var(--vinyl); border-radius: 50%; position: relative; overflow: hidden;
  box-shadow: 0 10px 20px rgba(0,0,0,0.45), inset 0 0 0 2px rgba(255,255,255,0.08);
  animation: none; transform: translateZ(0);
}
.vinyl-record.spinning { animation: vinylSpin 3.4s linear infinite; }

.record-image { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: block; }

.record-center { position: absolute; inset: 0; display: grid; place-items: center; pointer-events: none; }
.record-center::before {
  content: ""; width: clamp(18px, 4vw, 24px); height: clamp(18px, 4vw, 24px);
  border-radius: 50%; background: #8b5a2b;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.25);
}
.record-center::after {
  content: ""; position: absolute; width: 6px; height: 6px; border-radius: 50%; background: #5a3415;
}

.vinyl-record::after {
  content: ""; position: absolute; inset: 0; border-radius: 50%; pointer-events: none;
  background:
    radial-gradient(circle at 50% 50%, rgba(0,0,0,0) 58%, rgba(0,0,0,0.15) 59%, rgba(0,0,0,0) 60%),
    repeating-radial-gradient(circle at 50% 50%, rgba(255,255,255,0.04) 0 1px, rgba(0,0,0,0.04) 1px 2px);
  mix-blend-mode: multiply;
}

@keyframes vinylSpin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* ===== Notas musicais ===== */
.musical-notes { position: absolute; top: 6%; left: 55%; width: clamp(84px, 28vw, 128px); height: clamp(84px, 28vw, 128px); opacity: 0; transition: opacity 0.5s ease; pointer-events: none; }
.musical-notes.floating { opacity: 1; animation: float 3s ease-in-out infinite; }

.note { position: absolute; color: #e5f0ff; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.35); font-size: clamp(18px, 4vw, 26px); }
.note:nth-child(1) { top: 0; left: 20px; animation-delay: 0s; }
.note:nth-child(2) { top: 30px; left: 60px; animation-delay: 0.5s; }
.note:nth-child(3) { top: 60px; left: 10px; animation-delay: 1s; }
.note:nth-child(4) { top: 20px; left: 80px; animation-delay: 1.5s; }

@keyframes float { 0%,100% { transform: translateY(0) scale(1); opacity: 0.7; } 50% { transform: translateY(-20px) scale(1.2); opacity:1; } }

/* ===== Status / instruções ===== */
.controls { position: absolute; bottom: -88px; left: 50%; transform: translateX(-50%); text-align: center; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.5); width: 100%; }
.status { font-size: var(--status-size); font-weight: 700; margin-bottom: 8px; }
.instruction { font-size: var(--instruction-size); opacity: 0.9; }

/* ===== Cartão de Volume (desktop/tablet) ===== */
.volume-control {
  position: fixed; top: max(20px, env(safe-area-inset-top)); right: max(20px, env(safe-area-inset-right));
  color: #fff; background: rgba(255,255,255,0.12); backdrop-filter: blur(10px);
  padding: 14px; border-radius: 16px; text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
.volume-control label { font-size: 13px; display: block; margin-bottom: 8px; }
.volume-slider { width: 140px; }

/* ===== Acessibilidade: foco ===== */
.click-guard *:focus { outline: 2px dashed #fff; outline-offset: 4px; }
.no-pointer { pointer-events: none; }

@keyframes fadeInUp { from { opacity: 0; transform: translateY(50px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }

/* ===== Preferência do usuário: reduzir movimento ===== */
@media (prefers-reduced-motion: reduce){
  * { animation: none !important; transition: none !important; }
}

/* ===== Responsividade adicional ===== */
@media (max-width: 520px), (pointer: coarse){
  .music-box-container{ margin-bottom: 128px; }
  .volume-control{
    position: fixed; inset: auto 12px max(12px, env(safe-area-inset-bottom)) 12px; top: auto; right: auto;
    display: grid; grid-template-columns: 1fr; gap: 8px; padding: 12px 14px;
  }
  .volume-slider{ width: min(84vw, 360px); }
  .controls{ bottom: -104px; }
}

/* Telas muito baixas (paisagem em celular) */
@media (max-height: 520px){
  :root{ --box-w: min(74vw, 420px); }
  body{ padding-top: 24px; padding-bottom: calc(24px + env(safe-area-inset-bottom)); }
  .controls{ position: static; transform: none; margin-top: 16px; }
  .music-box-container{ margin-bottom: 24px; }
}
